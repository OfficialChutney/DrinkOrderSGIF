@page "/admin/teams"
@inherits AdminPageBase

@inject ITeamService TeamService

<PageTitle>Administrer hold</PageTitle>

@if (!IsAuthorized)
{
    <p>Sender til login side...</p>
}
else
{
    <h1>Teams</h1>

    <div class="admin-form">
        <input placeholder="Nyt hold navn" @bind="_newTeamName" />
        <button class="order-button" @onclick="AddTeam">Tilf√∏j hold</button>
    </div>

    @if (_teams.Count == 0)
    {
        <p>Ingen hold oprettet endnu.</p>
    }
    else
    {
        <div class="admin-list">
            @foreach (var team in _teams)
            {
                <div class="admin-row">
                    <div>
                        <strong>@team.Name</strong>
                        <span class="status-tag">@((team.IsActive) ? "Aktiv" : "Inaktiv")</span>
                    </div>
                    <button class="secondary-button" @onclick="() => ToggleTeam(team)">
                        @(team.IsActive ? "Fjern" : "Gendan")
                    </button>
                </div>
            }
        </div>
    }
}

@code {
    private string _newTeamName = string.Empty;
    private IReadOnlyList<Team> _teams = Array.Empty<Team>();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && await EnsureAuthorizedAsync())
        {
            await LoadTeamsAsync();
            StateHasChanged();
        }
    }

    private async Task LoadTeamsAsync()
    {
        _teams = await TeamService.GetAllTeamsAsync();
    }

    private async Task AddTeam()
    {
        if (string.IsNullOrWhiteSpace(_newTeamName))
        {
            return;
        }

        await TeamService.AddTeamAsync(_newTeamName);
        _newTeamName = string.Empty;
        await LoadTeamsAsync();
    }

    private async Task ToggleTeam(Team team)
    {
        await TeamService.SetTeamActiveAsync(team.Id, !team.IsActive);
        await LoadTeamsAsync();
    }
}
